/** 
 * (smt)2 simple mouse tracking - record mode (smt-record-2.0.0.js)
 * Copyleft (cc) 2006-2009 Luis Leiva
 * Release date: July 19th 2009 
 * http://smt.speedzinemedia.com
 */
(function(){var f={fps:24,recTime:120,smtPath:"/smt2",warn:false,warnText:"Your mouse movements are going to be logged.\nDo you agree?",disabled:0};var c=window.smtAuxFn;if(typeof c==="undefined"){throw ("auxiliar (smt)2 functions not found")}var b=window.smtRecordingOptions;if(typeof b!=="undefined"){c.overrideTrackingOptions(f,b)}var d=document.getElementsByTagName("script");for(var e=0,m=d.length;e<m;++e){var a=d[e].src;if(/smt-record/i.test(a)){var l=a.split("/");var g=c.array.indexOf(l,"smt2");if(g&&f.smtPath===null){f.smtPath=l.slice(0,g+1).join("/")}}}var j={i:0,mouse:{x:0,y:0},viewport:{width:0,height:0},discrepance:{x:1,y:1},coords:{x:[],y:[]},clicks:{x:[],y:[]},elem:{hovered:[],clicked:[]},url:null,rec:null,userId:null,append:null,paused:false,clicked:false,timeout:f.fps*f.recTime,xmlhttp:c.createXMLHTTPObject(),firstTimeUser:1,pauseRecording:function(){j.paused=true},resumeRecording:function(){j.paused=false},normalizeData:function(){var i=c.getWindowSize();j.discrepance.x=c.roundTo(i.width/j.viewport.width);j.discrepance.y=c.roundTo(i.height/j.viewport.height)},getMousePos:function(i){if(!i){i=window.event}if(i.pageX||i.pageY){j.mouse.x=i.pageX;j.mouse.y=i.pageY}else{if(i.clientX||i.clientY){j.mouse.x=i.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;j.mouse.y=i.clientY+document.body.scrollTop+document.documentElement.scrollTop}}},setClick:function(){j.clicked=true},releaseClick:function(){j.clicked=false},recMouse:function(){if(j.paused){return}if(j.i<j.timeout){var i=Math.round(j.discrepance.x*j.mouse.x);var n=Math.round(j.discrepance.y*j.mouse.y);if(i&&n){j.coords.x.push(i);j.coords.y.push(n);if(!j.clicked){j.clicks.x.push(null);j.clicks.y.push(null)}else{j.clicks.x.push(i);j.clicks.y.push(n)}}}else{clearInterval(j.rec);clearInterval(j.append)}++j.i},initMouseData:function(){j.updateViewPort();var i="url="+j.url;i+="&urltitle="+document.title;i+="&bname="+c.browserDetect.browser;i+="&bversion="+c.browserDetect.version;i+="&bos="+c.browserDetect.OS;i+="&bua="+navigator.userAgent;i+="&screenw="+screen.width;i+="&screenh="+screen.height;i+="&vpw="+j.viewport.width;i+="&vph="+j.viewport.height;i+="&time="+c.roundTo(j.i/f.fps);i+="&fps="+f.fps;i+="&ftu="+j.firstTimeUser;i+="&xcoords="+j.coords.x;i+="&ycoords="+j.coords.y;i+="&xclicks="+j.clicks.x;i+="&yclicks="+j.clicks.y;i+="&elhovered="+j.elem.hovered;i+="&elclicked="+j.elem.clicked;c.sendAjaxRequest({url:f.smtPath+"/core/store.php",callback:j.setUserId,postdata:i,xmlhttp:j.xmlhttp});j.clearMouseData()},setUserId:function(i){j.userId=i;if(j.userId>0){j.append=setInterval(j.appendMouseData,2000)}},appendMouseData:function(){if(!j.rec||j.paused){return false}var i="uid="+j.userId;i+="&time="+c.roundTo(j.i/f.fps);i+="&xcoords="+j.coords.x;i+="&ycoords="+j.coords.y;i+="&xclicks="+j.clicks.x;i+="&yclicks="+j.clicks.y;i+="&elhovered="+j.elem.hovered;i+="&elclicked="+j.elem.clicked;c.sendAjaxRequest({url:f.smtPath+"/core/append.php",postdata:i,xmlhttp:j.xmlhttp});j.clearMouseData()},clearMouseData:function(){j.coords.x=[];j.coords.y=[];j.clicks.x=[];j.clicks.y=[];j.elem.hovered=[];j.elem.clicked=[]},findElement:function(i){if(!i){i=window.event}c.widget.findDOMElement(i,function(n){if(i.type=="mousedown"){j.elem.clicked.push(n)}else{if(i.type=="mousemove"){j.elem.hovered.push(n)}}})},updateViewPort:function(){var i=c.getWindowSize();j.viewport.width=i.width;j.viewport.height=i.height},init:function(){j.updateViewPort();j.url=window.location.href;var i=Math.round(1000/f.fps);j.rec=setInterval(j.recMouse,i);c.allowTrackingOnFlashObjects();c.addEvent(document,"mousemove",j.getMousePos);c.addEvent(document,"mousedown",j.setClick);c.addEvent(document,"mouseup",j.releaseClick);c.addEvent(window,"resize",j.normalizeData);c.addEvent(window,"blur",j.pauseRecording);c.addEvent(window,"focus",j.resumeRecording);c.addEvent(document,"mousedown",j.findElement);c.addEvent(document,"mousemove",j.findElement);if(typeof window.onbeforeunload=="function"){c.addEvent(window,"beforeunload",j.appendMouseData)}else{c.addEvent(window,"unload",j.appendMouseData)}setTimeout(j.initMouseData,2000)}};if(f.disabled){return}var k=(f.warn)?window.confirm(f.warnText):true;if(!k){return}else{var h=c.cookies.checkCookie("isFirstTimeUser");j.firstTimeUser=(!h|0);c.cookies.setCookie("isFirstTimeUser",j.firstTimeUser,365)}c.browserDetect.init();c.onDOMload(j.init)})();