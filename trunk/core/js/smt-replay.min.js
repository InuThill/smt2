/** 
 * (smt)2 simple mouse tracking - replay mode
 * Copyleft (cc) 2006-2009 Luis Leiva
 * Release date: July 19th 2009
 * http://smt.speedzinemedia.com   
 */
(function(){var d={entryPt:"#9F6",exitPt:"#F66",regPt:"#F0F",regLn:"#0CC",click:"#F00",dDrop:"#ABC",varCir:"#F99",cenPt:"#DDD",clust:"#00F",realTime:true,bgLayer:true,bgColor:"#000",dirVect:false};var c=window.smtData;var h=window.jsGraphics;var a=window.smtAuxFn;if(typeof c==="undefined"){throw ("user data is malformed or not found")}if(typeof h==="undefined"){throw ("jsGraphics library not found")}if(typeof a==="undefined"){throw ("auxiliar (smt) functions not found")}var f=window.smtReplayOptions;if(typeof f!=="undefined"){a.overrideTrackingOptions(d,f)}var e=[];var b=[];var g={i:0,j:1,jMax:0,play:null,jg:null,jgClust:null,viewport:{width:0,height:0},discrepance:{x:1,y:1},paused:false,createCanvas:function(k){var l=document.createElement("div");l.id=k;l.style.position="absolute";l.style.top=0;l.style.left=0;l.style.width=100+"%";l.style.height=100+"%";l.style.zIndex=a.getNextHighestDepth();var j=40;var m=document.createElement("div");m.id=k+"Clust";m.style.position="absolute";m.style.top=0;m.style.left=0;m.style.width=100+"%";m.style.height=100+"%";m.style.opacity=j/100;m.style.filter="alpha(opacity="+j+")";m.style.zIndex=l.style.zIndex+1;var i=document.getElementsByTagName("body")[0];i.appendChild(l);i.appendChild(m);g.jg=new h(l.id);g.jgClust=new h(m.id)},setBgCanvas:function(k){var j=50,n=document.getElementById(k),m=a.getPageSize();var l=document.createElement("div");l.id=k+"Bg";l.style.position="absolute";l.style.top=0;l.style.left=0;l.style.width=m.width+"px";l.style.height=m.height+"px";l.style.overflow="hidden";l.style.backgroundColor=d.bgColor;l.style.opacity=j/100;l.style.filter="alpha(opacity="+j+")";l.style.zIndex=n.style.zIndex-1;var i=document.getElementsByTagName("body")[0];i.appendChild(l)},drawLine:function(j,i){g.jg.setColor(d.regLn);g.jg.drawLine(j.x,j.y,i.x,i.y);g.jg.paint()},drawClick:function(i,m,j){var k;if(!j){k=12;var l=3;g.jg.setColor(d.click);g.jg.drawLine(i-k,m-k,i-l,m-l);g.jg.drawLine(i-k,m+k,i-l,m+l);g.jg.drawLine(i+k,m-k,i+l,m-l);g.jg.drawLine(i+k,m+k,i+l,m+l)}else{k=6;g.jg.setColor(d.dDrop);g.jg.drawRect(i-k/2,m-k/2,k,k)}g.jg.paint()},drawDirectionArrow:function(l,k){var j=l.x-k.x,i=l.y-k.y,m=4;if(j>0&&i>0){g.jg.drawPolyline([k.x-m,k.x,k.x+m],[k.y+m,k.y,k.y+m])}else{if(j<0&&i>0){g.jg.drawPolyline([k.x-m,k.x,k.x-m],[k.y-m,k.y,k.y+m])}else{if(j<0&&i<0){g.jg.drawPolyline([k.x-m,k.x,k.x+m],[k.y-m,k.y,k.y-m])}else{if(j>0&&i<0){g.jg.drawPolyline([k.x+m,k.x,k.x+m],[k.y-m,k.y,k.y+m])}}}}g.jg.paint()},drawCursor:function(i,k,j){g.jg.setColor(j);g.jg.fillPolygon([i,i,i+4,i+6,i+9,i+7,i+15],[k,k+15,k+15,k+23,k+23,k+15,k+15]);g.jg.paint()},drawRegistrationPoint:function(i,j){g.jg.setColor(d.regPt);g.jg.fillRect(i-1,j-1,3,3);g.jg.paint()},drawVariableCircle:function(i,l,k){var j=a.roundTo(k/g.jMax);if(k*j===0){return}if(k>c.wcurr/2){k=Math.round(c.wcurr/2*j)}g.jg.setColor(d.varCir);g.jg.drawEllipse(i-k/2,l-k/2,k,k);g.jg.paint()},drawCentroid:function(){g.jg.setColor(d.cenPt);var k=Math.round(a.array.sum(e)*g.discrepance.x/e.length),j=Math.round(a.array.sum(b)*g.discrepance.y/b.length),i=20;g.jg.setStroke(5);g.jg.drawLine(k,j,k+i,j-i);g.jg.drawLine(k,j,k-i,j-i);g.jg.drawLine(k,j,k-i,j+i);g.jg.drawLine(k,j,k+i,j+i);g.jg.setStroke(0);g.jg.paint()},drawClusters:function(){g.jgClust.setColor(d.clust);var k;for(var j=0,l=c.clustsize.length;j<l;++j){k=c.clustsize[j];g.jgClust.fillEllipse(c.xclusters[j]*g.discrepance.x-k/2,c.yclusters[j]*g.discrepance.y-k/2,k,k)}g.jgClust.paint()},distance:function(j,i){return Math.sqrt(Math.pow(j.x-i.x,2)+Math.pow(j.y-i.y,2))},playMouse:function(){if(g.paused){return}var i={x:c.xcoords[g.i]*g.discrepance.x,y:c.ycoords[g.i]*g.discrepance.y};var l={x:c.xcoords[g.i+1]*g.discrepance.x,y:c.ycoords[g.i+1]*g.discrepance.y};var k={x:c.xclicks[g.i]*g.discrepance.x,y:c.yclicks[g.i]*g.discrepance.y};var n={x:c.xclicks[g.i+1]*g.discrepance.x,y:c.yclicks[g.i+1]*g.discrepance.y};if(g.i===0){g.drawCursor(i.x,i.y,d.entryPt)}if(g.i<c.xcoords.length){var m=g.distance(i,l);if(m){if(!d.dirVect){g.drawRegistrationPoint(i.x,i.y)}else{g.drawDirectionArrow(i,l)}if(g.j>1){g.drawVariableCircle(i.x,i.y,g.j)}g.j=1}else{++g.j}g.drawLine(i,l);if(k.x){var j=g.distance(k,n);if(!j){g.drawClick(n.x,n.y,false)}else{if(n.x!==0){g.drawClick(k.x,k.y,true)}}}++g.i}else{--g.i;i.x=c.xcoords[g.i]*g.discrepance.x;i.y=c.ycoords[g.i]*g.discrepance.y;g.drawCursor(i.x,i.y,d.exitPt);g.drawClusters();g.drawCentroid();clearInterval(g.play);g.play=null}},replay:function(i){if(i){var l=Math.round(1000/c.fps);g.play=setInterval(g.playMouse,l)}else{for(var j=0,m=c.xcoords.length;j<=m;++j){g.playMouse()}}},reset:function(){clearInterval(g.play);g.paused=false;g.i=0;g.j=1;g.jg.clear();g.jgClust.clear()},helpKeys:function(m){if(!d.realTime){return}if(!m){m=window.event}var l=m.keyCode||m.which;if(l==27){clearInterval(g.play);g.paused=false;for(var i=g.i,j=c.xcoords.length;i<=j;++i){g.playMouse()}d.realTime=false}else{if(l==32){g.paused=!g.paused}}},init:function(){var m=a.getWindowSize();g.viewport.width=m.width;g.viewport.height=m.height;if(c.wprev&&c.hprev){g.discrepance.x=a.roundTo(c.wcurr/c.wprev);g.discrepance.y=a.roundTo(c.hcurr/c.hprev)}var o=[];var n=1;for(var l=0,i=c.xcoords.length;l<i;++l){if(c.xcoords[l]==c.xcoords[l+1]&&c.ycoords[l]==c.ycoords[l+1]){++n}else{if(n>1){o.push(n)}n=1;e.push(c.xcoords[l]);b.push(c.ycoords[l])}}g.jMax=a.array.max(o);var j="smtCanvas";g.createCanvas(j);if(d.bgLayer){g.setBgCanvas(j)}a.allowTrackingOnFlashObjects();g.replay(d.realTime)}};a.addEvent(document,"keyup",g.helpKeys);a.onDOMload(g.init)})();